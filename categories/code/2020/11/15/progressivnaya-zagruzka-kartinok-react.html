<!DOCTYPE html> <html lang="ru"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta property="og:image" content="/assets/images/2020-11-15-progressivnaya-zagruzka-kartinok-react/top_image.gif" /><!-- Begin Jekyll SEO tag v2.6.1 --> <title>Прогрессивная загрузка картинок в React | Losthuman</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Прогрессивная загрузка картинок в React" /> <meta property="og:locale" content="ru" /> <meta name="description" content="Вы когда-нибудь задумывались, как Medium загружает изображения? Возможно, вы заметили, как изображения отображаются в несколько этапов. В самом начале на экране появляется размытая версия изображения, которая затем заменяется полноразмерной версией." /> <meta property="og:description" content="Вы когда-нибудь задумывались, как Medium загружает изображения? Возможно, вы заметили, как изображения отображаются в несколько этапов. В самом начале на экране появляется размытая версия изображения, которая затем заменяется полноразмерной версией." /> <link rel="canonical" href="http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" /> <meta property="og:url" content="http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" /> <meta property="og:site_name" content="Losthuman" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-11-15T00:00:00+05:00" /> <script type="application/ld+json"> {"headline":"Прогрессивная загрузка картинок в React","dateModified":"2020-11-15T00:00:00+05:00","datePublished":"2020-11-15T00:00:00+05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html"},"description":"Вы когда-нибудь задумывались, как Medium загружает изображения? Возможно, вы заметили, как изображения отображаются в несколько этапов. В самом начале на экране появляется размытая версия изображения, которая затем заменяется полноразмерной версией.","@type":"BlogPosting","url":"http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="/assets/likely.css"> <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Losthuman" /><!-- Put this script tag to the <head> of your page --> <script type="text/javascript" src="https://vk.com/js/api/openapi.js?160"></script></head> <body><header class="site-header" role="banner"> <div class="wrapper"> <a class="site-title" rel="author" href="/">Losthuman</a> <nav class="site-nav site-nav-custom"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"> <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/> </svg> </span> </label> <div class="trigger"> <a class="page-link" href="/about/">О проекте</a> <a class="page-link" href="/categories/technews/index.html">Technews</a> <a class="page-link" href="/categories/code/index.html">Code</a> <a class="page-link" href="/categories/library/index.html">Library</a> </div> </nav> </div> </header> <main class="page-content" aria-label="Content"> <div class="wrapper"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-fg+4w-s-a4+kz" data-ad-client="ca-pub-5706627784425194" data-ad-slot="4102621418"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <div class="container-fluid"> <div class="row"> <div class="col-md-8"> <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title p-name" itemprop="name headline">Прогрессивная загрузка картинок в React</h1> <p class="post-meta"> <time class="dt-published" datetime="2020-11-15T00:00:00+05:00" itemprop="datePublished">Nov 15, 2020 </time></p> </header> <div class="post"> <div class="post-image"> <img src="/assets/images/2020-11-15-progressivnaya-zagruzka-kartinok-react/top_image.gif" alt="Картинка" > </div> </div> <div class="post-content e-content" itemprop="articleBody"> <p>Вы когда-нибудь задумывались, как <a href="https://medium.com">Medium</a> загружает изображения? Возможно, вы заметили, как изображения отображаются в несколько этапов. В самом начале на экране появляется размытая версия изображения, которая затем заменяется полноразмерной версией.</p> <h4 id="как-medium-stories-загружает-изображения">Как Medium Stories загружает изображения</h4> <ul> <li>Загрузка изображения не начинается, пока изображение не попадет в область просмотра.</li> <li>Затем загружается «размытый» эскиз.</li> <li>Затем загружается полноразмерное изображение и заменяет эскиз.</li> </ul> <p>Мы можем разделить эту технику загрузки изображений на две отдельные функции.</p> <h4 id="1-ленивая-загрузка-lazy-loading">1. Ленивая загрузка (Lazy loading)</h4> <blockquote> <p>Ленивая загрузка - это метод, который откладывает загрузку некритических ресурсов во время загрузки страницы. Вместо этого эти некритические ресурсы загружаются в момент необходимости. Что касается изображений, «некритичный» часто является синонимом «вне экрана».— <a href="https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video">developers.google.com</a></p> </blockquote> <h4 id="2-размытие-картинки">2. Размытие картинки</h4> <p>Чтобы что-то отобразить на экране быстрее, мы показываем размытое крошечное изображение, масштабированное до полной ширины. Когда мы закончим загрузку полноразмерного изображения, мы меняем их местами.</p> <p>Если вы раньше работали с <a href="https://www.gatsbyjs.com/">Gatsby</a>, вы, вероятно, использовали gatsby-image. Gatsby-image дает нам эти две техники без необходимости создавать их самостоятельно. Но мы разработчики. Мы любим все делать сами.</p> <h3 id="давайте-сделаем">Давайте сделаем</h3> <p>Прежде всего, проанализируем проблему.</p> <ul> <li>Нам нужно знать, какие изображения попали в область просмотра.</li> <li>Как только изображение попадает в область просмотра, нам нужно загрузить миниатюру и полноразмерное изображение.</li> <li>После загрузки полноразмерного изображения нам нужно поменять миниатюру.</li> <li>Нам нужно убедиться, что наша страница не «прыгает» при загрузке изображений. Наш контейнер-заполнитель должен иметь ту же высоту и ширину, что и наше окончательное изображение.</li> </ul> <h3 id="начнем-проект">Начнем проект</h3> <p>Начнем с создания нового приложения React с помощью приложения <code class="language-plaintext highlighter-rouge">create-react-app</code>.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">npx</span> <span class="nx">create</span><span class="o">-</span><span class="nx">react</span><span class="o">-</span><span class="nx">app</span> <span class="nx">progressive</span><span class="o">-</span><span class="nx">images</span>
</code></pre></div></div> <p>Будем использовать <a href="ttps://unsplash.com/">Unsplash</a> , как базу данных изображений. Для этого получим с помощью API Unsplash массив из десяти первых попавшихся изображений. Этот массив сохранен в <a href="https://gist.github.com/montezume/daaebfca37120a4994402b31de527c07">Github Gist</a>.</p> <p>Скопируйте и вставьте содержимое этой ссылки в файл с именем <code class="language-plaintext highlighter-rouge">images.json</code>.</p> <p>Теперь откройте <code class="language-plaintext highlighter-rouge">App.js</code> и замените его содержание следующим кодом.</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span> 
<span class="k">import</span> <span class="nx">images</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./images.json</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ImageContainer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./components/image-container</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">./App.css</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"app"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"container"</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">images</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">key</span><span class="p">=</span><span class="si">{</span><span class="nx">res</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span> <span class="na">className</span><span class="p">=</span><span class="s">"wrapper"</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nc">ImageContainer</span>
                <span class="na">src</span><span class="p">=</span><span class="si">{</span><span class="nx">res</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">regular</span><span class="si">}</span>
                <span class="na">thumb</span><span class="p">=</span><span class="si">{</span><span class="nx">res</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">thumb</span><span class="si">}</span>
                <span class="na">height</span><span class="p">=</span><span class="si">{</span><span class="nx">res</span><span class="p">.</span><span class="nx">height</span><span class="si">}</span>
                <span class="na">width</span><span class="p">=</span><span class="si">{</span><span class="nx">res</span><span class="p">.</span><span class="nx">width</span><span class="si">}</span>
                <span class="na">alt</span><span class="p">=</span><span class="si">{</span><span class="nx">res</span><span class="p">.</span><span class="nx">alt_description</span><span class="si">}</span>
              <span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">);</span>
        <span class="p">})</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div></div> <p>После откройте <code class="language-plaintext highlighter-rouge">App.css</code> и вставьте следующий код.</p> <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.app</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">padding-top</span><span class="p">:</span> <span class="m">1em</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.container</span> <span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">600px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.wrapper</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">1em</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Теперь давайте создадим директорию <code class="language-plaintext highlighter-rouge">components</code>, в которую будем помещать компоненты для нашего приложения. И, первым делом создадим файл <code class="language-plaintext highlighter-rouge">image-container.js</code>, с компонентом <code class="language-plaintext highlighter-rouge">ImageContainer</code>, отвечающим за контейнер для тех изображений, которые мы планируем загружать. Там же создадим файл <code class="language-plaintext highlighter-rouge">image-container.css</code> со стилями для нашего компонента.</p> <p><img src="/assets/images/2020-11-15-progressivnaya-zagruzka-kartinok-react/5.png" alt="5" /></p> <p>В компоненте <code class="language-plaintext highlighter-rouge">ImageContainer</code> определяем соотношение сторон изображения в константе<code class="language-plaintext highlighter-rouge">aspectRatio</code>. Оно рассчитывается в процентах путем деления ширины изображения на его на высоту и умножения на <code class="language-plaintext highlighter-rouge">100</code>. Затем мы добавляем свойство <code class="language-plaintext highlighter-rouge">padding-bottom </code> к стилю нашего контейнера изображения с этим значением. Свойство <code class="language-plaintext highlighter-rouge">padding-bottom </code> задает внутренний нижний отступ от содержания до нижней границы элемента. Например, изображение 1024 x 768 пикселей имеет соотношение сторон 0,75. В этом случае <code class="language-plaintext highlighter-rouge">padding-bottom: 75%</code> .</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">./image-container.css</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ImageContainer</span> <span class="o">=</span> <span class="nx">props</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">aspectRatio</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="nx">props</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span> 
<span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span>
      <span class="na">className</span><span class="p">=</span><span class="s">"image-container"</span>
      <span class="na">style</span><span class="p">=</span><span class="si">{</span> <span class="p">{</span> <span class="na">paddingBottom</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">aspectRatio</span><span class="p">}</span><span class="s2">%`</span> <span class="p">}</span><span class="si">}</span> 
    <span class="p">/&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">ImageContainer</span><span class="p">;</span>
</code></pre></div></div> <p>И <code class="language-plaintext highlighter-rouge">image-container.css</code> .</p> <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.image-container</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
  <span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.05</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div> <p>Мы можем запустить наше приложение с <code class="language-plaintext highlighter-rouge">yarn start</code> (или <code class="language-plaintext highlighter-rouge">npm start</code>) и посмотреть, как оно выглядит.</p> <p><img src="/assets/images/2020-11-15-progressivnaya-zagruzka-kartinok-react/1.gif" alt="1" /></p> <p>Теперь у нас есть несколько блоков того же размера, что и изображения, которые мы хотим визуализировать.</p> <h3 id="intersection-observer">Intersection Observer</h3> <blockquote> <p>API-интерфейс Intersection Observer обеспечивает способ асинхронного наблюдения за изменениями пересечения целевого элемента с элементом-предком или с окном просмотра документа верхнего уровня - developer.mozilla.org</p> </blockquote> <p>Сделаем кастомный хук . Создаем директорию <code class="language-plaintext highlighter-rouge">hooks</code>, в которой файл <code class="language-plaintext highlighter-rouge">use-intersection-observer.js</code>.</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">useIntersectionObserver</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">target</span><span class="p">,</span>
  <span class="nx">onIntersect</span><span class="p">,</span>
  <span class="nx">threshold</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
  <span class="nx">rootMargin</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">0px</span><span class="dl">"</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IntersectionObserver</span><span class="p">(</span><span class="nx">onIntersect</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">rootMargin</span><span class="p">,</span>
      <span class="nx">threshold</span>
    <span class="p">});</span>
<span class="kd">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
<span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">useIntersectionObserver</span><span class="p">;</span>
</code></pre></div></div> <p>Поскольку мы не определили параметр <code class="language-plaintext highlighter-rouge">root</code>, <code class="language-plaintext highlighter-rouge">IntersectionObserver</code> по умолчанию использует область просмотра. Мы определили параметр <code class="language-plaintext highlighter-rouge">threshold</code> равным <code class="language-plaintext highlighter-rouge">0,1</code>. Это означает, что когда 10% таргета видны в области просмотра, вызывается callback функция.</p> <h3 id="использование-нашего-кастомного-хука">Использование нашего кастомного хука</h3> <p>Чтобы использовать этот кастомный хук, нам нужно вызвать его с таргетом и callback функцией. Наш таргет в данном случае - React <code class="language-plaintext highlighter-rouge">ref</code>, прикрепленный к контейнеру <code class="language-plaintext highlighter-rouge">div</code>.</p> <p>Наша callback функция установит переменную состояния, указывающую, что изображение в зоне видимости. Затем функция вызовет <code class="language-plaintext highlighter-rouge">Observer.unobserve</code>. Когда изображение становится видимым, нам больше не нужен <code class="language-plaintext highlighter-rouge">IntersectionObserver</code>.</p> <p>Сделаем следующие изменения в файле <code class="language-plaintext highlighter-rouge">image-container.js</code>.</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">useIntersectionObserver</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../hooks/use-intersection-observer</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">./image-container.css</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ImageContainer</span> <span class="o">=</span> <span class="nx">props</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useRef</span><span class="p">();</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">isVisible</span><span class="p">,</span> <span class="nx">setIsVisible</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">useIntersectionObserver</span><span class="p">({</span>
    <span class="na">target</span><span class="p">:</span> <span class="nx">ref</span><span class="p">,</span>
    <span class="na">onIntersect</span><span class="p">:</span> <span class="p">([{</span> <span class="nx">isIntersecting</span> <span class="p">}],</span> <span class="nx">observerElement</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isIntersecting</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setIsVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">observerElement</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="kd">const</span> <span class="nx">aspectRatio</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="nx">props</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
<span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span>
      <span class="na">ref</span><span class="p">=</span><span class="si">{</span><span class="nx">ref</span><span class="si">}</span>
      <span class="na">className</span><span class="p">=</span><span class="s">"image-container"</span>
      <span class="na">style</span><span class="p">=</span><span class="si">{</span> <span class="p">{</span> <span class="na">paddingBottom</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">aspectRatio</span><span class="p">}</span><span class="s2">%`</span> <span class="p">}</span><span class="si">}</span>
    <span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">isVisible</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">className</span><span class="p">=</span><span class="s">"image"</span> <span class="na">src</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">src</span><span class="si">}</span> <span class="na">alt</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">alt</span><span class="si">}</span> <span class="p">/&gt;</span>
       <span class="p">)</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">ImageContainer</span><span class="p">;</span>
</code></pre></div></div> <p>Теперь мы визуализируем полноразмерное изображение, когда наш компонент входит в область просмотра. В действии это выглядит так.</p> <p><img src="/assets/images/2020-11-15-progressivnaya-zagruzka-kartinok-react/2.gif" alt="2" /></p> <p>Наше приложение теперь “лениво” загружает изображения. Наши изображения загружаются только тогда, когда они видны в области просмотра. Если вы проверите вкладку Network в браузере, вы можете увидеть это в действии. Загрузка фотогрфий происходит “лесенкой” или “водопадом”.</p> <p><img src="/assets/images/2020-11-15-progressivnaya-zagruzka-kartinok-react/3.png" alt="3" /></p> <h4 id="добавление-техники-размытия-blur---эффект">Добавление техники размытия (Blur - эффект)</h4> <p>Начнем с создания двух новых файлов в директории <code class="language-plaintext highlighter-rouge">components</code> : <code class="language-plaintext highlighter-rouge">image.js</code> и <code class="language-plaintext highlighter-rouge">image.css</code>. Наш компонент <code class="language-plaintext highlighter-rouge">Image </code> будет отображать два изображения: полноразмерное изображение и миниатюру. Мы будем скрывать миниатюру, когда загружается полноразмерное изображение.</p> <p>Добавим следующий код в файл <code class="language-plaintext highlighter-rouge">components/image.js</code>.</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">./image.css</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Image</span> <span class="o">=</span> <span class="nx">props</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">isLoaded</span><span class="p">,</span> <span class="nx">setIsLoaded</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">React</span><span class="p">.</span><span class="nc">Fragment</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">img</span>
        <span class="na">className</span><span class="p">=</span><span class="s">"image thumb"</span>
        <span class="na">alt</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">alt</span><span class="si">}</span>
        <span class="na">src</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">thumb</span><span class="si">}</span>
        <span class="na">style</span><span class="p">=</span><span class="si">{</span> <span class="p">{</span> <span class="na">visibility</span><span class="p">:</span> <span class="nx">isLoaded</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">hidden</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">visible</span><span class="dl">"</span> <span class="p">}</span><span class="si">}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">img</span>
        <span class="na">onLoad</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">setIsLoaded</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span><span class="si">}</span>
        <span class="na">className</span><span class="p">=</span><span class="s">"image full"</span>
        <span class="na">style</span><span class="p">=</span><span class="si">{</span> <span class="p">{</span> <span class="na">opacity</span><span class="p">:</span> <span class="nx">isLoaded</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span><span class="si">}</span>
        <span class="na">alt</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">alt</span><span class="si">}</span>
        <span class="na">src</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">src</span><span class="si">}</span>
      <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nc">React</span><span class="p">.</span><span class="nc">Fragment</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Image</span><span class="p">;</span>
</code></pre></div></div> <p>И в файл <code class="language-plaintext highlighter-rouge">components/image.css</code> добавим код CSS.</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nx">image</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nx">absolute</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nx">full</span> <span class="p">{</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="nx">opacity</span> <span class="mi">400</span><span class="nx">ms</span> <span class="nx">ease</span> <span class="mi">0</span><span class="nx">ms</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nx">thumb</span> <span class="p">{</span>
  <span class="nl">filter</span><span class="p">:</span> <span class="nx">blur</span><span class="p">(</span><span class="mi">20</span><span class="nx">px</span><span class="p">);</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="nx">scale</span><span class="p">(</span><span class="mf">1.1</span><span class="p">);</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="nx">visibility</span> <span class="mi">0</span><span class="nx">ms</span> <span class="nx">ease</span> <span class="mi">400</span><span class="nx">ms</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Наш основной компонент <code class="language-plaintext highlighter-rouge">ImageContainer</code> после добавления в него компонента <code class="language-plaintext highlighter-rouge">Image</code> должен выглядеть следующим образом:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">useIntersectionObserver</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../hooks/use-intersection-observer</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">./image-container.css</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Image</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./image</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">ImageContainer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useRef</span><span class="p">();</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">isVisible</span><span class="p">,</span> <span class="nx">setIsVisible</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

  <span class="nx">useIntersectionObserver</span><span class="p">({</span>
    <span class="na">target</span><span class="p">:</span> <span class="nx">ref</span><span class="p">,</span>
    <span class="na">onIntersect</span><span class="p">:</span> <span class="p">([{</span> <span class="nx">isIntersecting</span> <span class="p">}],</span> <span class="nx">observerElement</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isIntersecting</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setIsVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">observerElement</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">aspectRatio</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="nx">props</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span>
      <span class="na">ref</span><span class="p">=</span><span class="si">{</span><span class="nx">ref</span><span class="si">}</span>
      <span class="na">className</span><span class="p">=</span><span class="s">"image-container"</span>
      <span class="na">style</span><span class="p">=</span><span class="si">{</span> <span class="p">{</span> <span class="na">paddingBottom</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">aspectRatio</span><span class="p">}</span><span class="s2">%`</span> <span class="p">}</span><span class="si">}</span>
    <span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">isVisible</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Image</span> <span class="na">src</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">src</span><span class="si">}</span> <span class="na">thumb</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">thumb</span><span class="si">}</span> <span class="na">alt</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">alt</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">)</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ImageContainer</span><span class="p">;</span>
</code></pre></div></div> <p>Теперь давайте запустим наше приложение в последний раз. Обязательно откройте devtools в браузере и сбросьте кеширование.</p> <p><img src="/assets/images/2020-11-15-progressivnaya-zagruzka-kartinok-react/4.gif" alt="4" /></p> <p>Мы сделали приложение React с отложенной загрузкой изображений. Наше приложение отображает изображения только после того, как они попадают в область просмотра. Он также постепенно отображает их, сначала показывая размытые миниатюры.</p> <p><a href="https://medium.com/frontend-digest/progressively-loading-images-in-react-107cb075417a">Источник</a></p> </div> <div class="likely likely-post"> <div class="telegram" data-url="http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" data-title="Прогрессивная загрузка картинок в React">Отправить</div> <div class="vkontakte" data-url="http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" data-title="Прогрессивная загрузка картинок в React">Поделиться</div> <!-- <div class="odnoklassniki" data-url="http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" data-title="Прогрессивная загрузка картинок в React">Класснуть</div> --> <div class="facebook" data-url="http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" data-title="Прогрессивная загрузка картинок в React">Поделиться</div> <div class="twitter" data-url="http://localhost:4000/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" data-title="Прогрессивная загрузка картинок в React">Твитнуть</div> </div> <!-- <div class="article-ad"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5706627784425194" data-ad-slot="8358109938"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div> --> <!----><div id="vk_comments"></div> <script type="text/javascript"> window.onload = function () { VK.init({apiId: 7004890, onlyWidgets: true}); VK.Widgets.Comments('vk_comments', {limit: 20, attach: "graffiti,photo,video,audio", norealtime: 0}); } </script><a class="u-url" href="/categories/code/2020/11/15/progressivnaya-zagruzka-kartinok-react.html" hidden></a> </article> </div> <div class="col-md-4"> <div class="article-ad"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- losthuman-aside --> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5706627784425194" data-ad-slot="4814492309" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div><ul> <li class="tags" ><a href="/tags/iphone">iphone (1) </a> </li> <li class="tags" ><a href="/tags/apple">apple (4) </a> </li> <li class="tags" ><a href="/tags/security">security (5) </a> </li> <li class="tags" ><a href="/tags/hackers">hackers (1) </a> </li> <li class="tags" ><a href="/tags/google">google (2) </a> </li> <li class="tags" ><a href="/tags/angular">angular (1) </a> </li> <li class="tags" ><a href="/tags/programming">programming (11) </a> </li> <li class="tags" ><a href="/tags/gagets">gagets (3) </a> </li> <li class="tags" ><a href="/tags/regex">regex (1) </a> </li> <li class="tags" ><a href="/tags/wordpress">wordpress (1) </a> </li> <li class="tags" ><a href="/tags/python">python (4) </a> </li> <li class="tags" ><a href="/tags/twitter">twitter (1) </a> </li> <li class="tags" ><a href="/tags/shazam">shazam (1) </a> </li> <li class="tags" ><a href="/tags/application">application (1) </a> </li> <li class="tags" ><a href="/tags/photo">photo (1) </a> </li> <li class="tags" ><a href="/tags/css">css (1) </a> </li> <li class="tags" ><a href="/tags/bittorrent">bittorrent (1) </a> </li> <li class="tags" ><a href="/tags/amazon">amazon (1) </a> </li> <li class="tags" ><a href="/tags/swift">swift (5) </a> </li> <li class="tags" ><a href="/tags/IOS">IOS (1) </a> </li> <li class="tags" ><a href="/tags/uber">uber (1) </a> </li> <li class="tags" ><a href="/tags/npm">npm (1) </a> </li> <li class="tags" ><a href="/tags/nodejs">nodejs (1) </a> </li> <li class="tags" ><a href="/tags/code">code (2) </a> </li> <li class="tags" ><a href="/tags/jekyll">jekyll (2) </a> </li> <li class="tags" ><a href="/tags/github">github (1) </a> </li> <li class="tags" ><a href="/tags/gitgubgages">gitgubgages (1) </a> </li> <li class="tags" ><a href="/tags/react">react (1) </a> </li> <li class="tags" ><a href="/tags/tutorials">tutorials (1) </a> </li> </ul><div class="btcwdgt-chart"> style="margin-top: 30px"> <script> (function(b,i,t,C,O,I,N) { window.addEventListener('load',function() { if(b.getElementById(C))return; I=b.createElement(i),N=b.getElementsByTagName(i)[0]; I.src=t;I.id=C;N.parentNode.insertBefore(I, N); },false) })(document,'script','https://widgets.bitcoin.com/widget.js','btcwdgt'); </script> </div> </div> </div> </div> <div class="article-ad"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5706627784425194" data-ad-slot="8358109938"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div> </div> </main><footer class="site-footer h-card"> <data class="u-url" href="/"></data> <div class="wrapper"> <h2 class="footer-heading">Losthuman</h2> <div class="footer-col-wrapper"> <div class="footer-col footer-col-1"> <ul class="contact-list"> <li class="p-name">Losthuman</li><li><a class="u-email" href="mailto:info@losthuman.ru">info@losthuman.ru</a></li></ul> </div> <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://twitter.com/losthuman9"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">losthuman9</span></a></li></ul> </div> <div class="footer-col footer-col-3"> <p>Никакого особого смысла в этом сайте нет</p> </div> </div> </div> </footer> <script src="/assets/likely.js"></script> </body> </html>
