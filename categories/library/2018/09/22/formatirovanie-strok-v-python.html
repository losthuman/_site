<!DOCTYPE html> <html lang="ru"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta property="og:image" content="/assets/images/2018-09-22-formatirovanie-strok-v-python/top_image.jpg" /><!-- Begin Jekyll SEO tag v2.6.1 --> <title>Форматирование строк в python | Losthuman</title> <meta name="generator" content="Jekyll v4.0.0" /> <meta property="og:title" content="Форматирование строк в python" /> <meta property="og:locale" content="ru" /> <meta name="description" content="Как работают четыре подхода к форматированию строк и каковы их сильные и слабые стороны. Простое “эмпирическое правило” для того, чтобы выбрать лучший подход к форматированию строк общего назначения." /> <meta property="og:description" content="Как работают четыре подхода к форматированию строк и каковы их сильные и слабые стороны. Простое “эмпирическое правило” для того, чтобы выбрать лучший подход к форматированию строк общего назначения." /> <link rel="canonical" href="https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html" /> <meta property="og:url" content="https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html" /> <meta property="og:site_name" content="Losthuman" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-09-22T00:00:00+05:00" /> <script type="application/ld+json"> {"description":"Как работают четыре подхода к форматированию строк и каковы их сильные и слабые стороны. Простое “эмпирическое правило” для того, чтобы выбрать лучший подход к форматированию строк общего назначения.","headline":"Форматирование строк в python","dateModified":"2018-09-22T00:00:00+05:00","datePublished":"2018-09-22T00:00:00+05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html"},"url":"https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="/assets/likely.css"> <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://losthuman.ru/feed.xml" title="Losthuman" /><!-- Put this script tag to the <head> of your page --> <script type="text/javascript" src="https://vk.com/js/api/openapi.js?160"></script></head> <body><header class="site-header" role="banner"> <div class="wrapper"> <a class="site-title" rel="author" href="/">Losthuman</a> <nav class="site-nav site-nav-custom"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"> <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/> </svg> </span> </label> <div class="trigger"> <a class="page-link" href="/about/">О проекте</a> <a class="page-link" href="/categories/technews/index.html">Technews</a> <a class="page-link" href="/categories/code/index.html">Code</a> <a class="page-link" href="/categories/library/index.html">Library</a> </div> </nav> </div> </header> <main class="page-content" aria-label="Content"> <div class="wrapper"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-fg+4w-s-a4+kz" data-ad-client="ca-pub-5706627784425194" data-ad-slot="4102621418"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <div class="container-fluid"> <div class="row"> <div class="col-md-8"> <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title p-name" itemprop="name headline">Форматирование строк в python</h1> <p class="post-meta"> <time class="dt-published" datetime="2018-09-22T00:00:00+05:00" itemprop="datePublished">Sep 22, 2018 </time></p> </header> <div class="post"> <div class="post-image"> <img src="/assets/images/2018-09-22-formatirovanie-strok-v-python/top_image.jpg" alt="Картинка" > </div> </div> <div class="post-content e-content" itemprop="articleBody"> <h4 id="1--старый-стиль-форматирования-строк">1 – “Старый стиль” форматирования строк</h4> <p>Строки в Python имеют уникальную встроенную операцию, к которой можно получить доступ с помощью оператора - <code class="highlighter-rouge">%</code>. Это ярлык, который позволяет легко создавать позиционное форматирование. Если вы когда-либо работали с функцией printf в C, вы сразу узнаете, как это работает. Вот простой пример:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; 'Привет, %s' %'Олег' 
'Привет, Олег'
</code></pre></div></div> <p>В примере выше используется спецификатор формата <code class="highlighter-rouge">%s</code>, чтобы указать python’у, где заменить значение имени, представленного в виде строки. Это называется форматированием строк «старого стиля».</p> <p>В python для форматирования строк таким стилем имеются и другие спецификаторы формата. Например, можно преобразовать числа в шестнадцатеричную нотацию или добавить пробелы для создания красиво отформатированных таблиц и отчетов.</p> <p>В следующем примере используется спецификатор формата <code class="highlighter-rouge">%x</code>, чтобы преобразовать значение <code class="highlighter-rouge">int</code> в строку и представить его как шестнадцатеричное число:</p> »&gt; ‘%x’ %’badc0ffee’ ‘badc0ffee’ <p>Синтаксис форматирования строки ”старым стилем” изменяется незначительно, если вы хотите сделать несколько замен в одной строке. Поскольку оператор <code class="highlighter-rouge">%</code> принимает только один аргумент, необходимо обернуть правую часть в кортеж, например:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &gt;&gt;&gt; 'Привет %s, у нас 0x%x ошибка!' % (name, errno) 
 'Привет Олег, у нас 0xbadc0ffee ошибка!'
</code></pre></div></div> <p>Также можно ссылаться на подстановки переменных по имени в форматируемой строке, если передать сопоставление оператору <code class="highlighter-rouge">%</code>:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; 'Привет %(name)s, у нас 0x%(errno)x ошибка!' %{ ... "name": name, "errno": errno }
'Привет Олег, у нас 0xbadc0ffee ошибка!'
</code></pre></div></div> <p>Это упрощает процесс форматирования и упрощает его модификацию в будущем. Вам не нужно беспокоиться о том, что порядок, который вы передаете в значениях, совпадает с порядком, на который ссылаются значения в форматируемой строке. Конечно, недостатком является то, что этот метод требует немного больше кода.</p> <p>Может показаться странным, почему это форматирование в стиле printf называется форматированием строки «старого стиля». Технически этот стиль форматирования строк заменен форматированием «нового стиля», о котором будет сказано ниже. Но в то же время форматирование «старого стиля» фактически не устарело. Такой стиль по-прежнему поддерживается в самых последних версиях Python.</p> <h4 id="2--форматирование-строк-новым-стилем">2 – Форматирование строк “новым стилем”</h4> <p>В Python 3 был представлен новый способ форматирования строк, который также был позже включен в Python 2.7. Это форматирование строки «нового стиля» избавилось от оператора <code class="highlighter-rouge">%</code> и делает синтаксис форматирования строк более регулярным. Теперь форматирование обрабатывается вызовом функции format () для строкового объекта.</p> <p>Можно использовать функцию format() для простого форматирования позиционирования, как и при форматировании «старым стилем»:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; 'Привет, {}'.format(name) 
'Привет, Олег'
</code></pre></div></div> <p>Или можно ссылаться на свои подстановки переменных по имени и использовать их в любом порядке. Это довольно мощная функция, поскольку она позволяет повторно упорядочить порядок отображения без изменения аргументов, переданных функции формата:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &gt;&gt;&gt; 'Привет {name}, у нас 0x{errno:x} ошибка!'
 .format( ... name=name, errno=errno)
'Привет Олег, у нас 0xbadc0ffee ошибка!'
</code></pre></div></div> <p>Это также показывает, что синтаксис для форматирования переменной int как шестнадцатеричной строки изменился. Теперь нам нужно передать спецификацию формата, добавив суффикс «<code class="highlighter-rouge">:x</code>» после имени переменной.</p> <p>В целом синтаксис форматируемой строки стал более мощным, не усложняя более простые варианты использования.</p> <p>В Python 3 это форматирование строки с помощью «нового стиля» предпочтительнее, чем форматирование в стиле <code class="highlighter-rouge">%</code>. Однако, начиная с Python 3.6, есть еще лучший способ форматирования строк. Об этом в следующем разделе.</p> <h4 id="3--интерполяция-строкового-литерала-python-36">3 – Интерполяция строкового литерала (Python 3.6+)</h4> <p>Python 3.6 добавляет еще один способ форматирования строк, называемых форматированные строковые литералы. Этот новый способ форматирования строк позволяет использовать встроенные выражения Python внутри строковых констант. Вот простой пример, который поможет вам почувствовать эту функцию:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; f'Привет, {name}!' 
'Привет, Олег!'
</code></pre></div></div> <p>Этот новый синтаксис форматирования является довольно мощным. Поскольку вы можете вставлять произвольные выражения python, вы можете даже выполнить внутристрочную арифметику с ним, например:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; a = 5
&gt;&gt;&gt; b = 10
&gt;&gt;&gt; f'Пять плюс десять равно {a + b} а не {2 * (a + b)}.'
'Пять плюс десять равно  15 а не 30.'
</code></pre></div></div> <p>В основе способа форматированных строковых литералов лежит функция парсера Python, которая преобразует f-строки в ряд строковых констант и выражений. Затем они соединяются, чтобы представить финальную строку.</p> <p>Допустим, что у нас есть следующая функция greet (), содержащая f-строку:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &gt;&gt;&gt; def greet(name, question):
... 	return f"Привет, {name}! Как {question}?" 
...

&gt;&gt;&gt; greet('Олег', 'дела') "Привет, Олег! Как дела?"
</code></pre></div></div> <p>Если разобрать функцию и проверить, что происходит в при ее выполнении, можно увидеть, что f-строка в функции преобразуется во что - то похожее на следующее:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; def greet(name, question):
... 	return ("Привет, " + name + "! Как " +
				question + "?")
</code></pre></div></div> <p>Строковые литералы также поддерживают существующий синтаксис строки формата str.метод format(). Это позволяет решить те же проблемы форматирования, которые мы обсуждали в предыдущих двух разделах:</p> »&gt; f”Привет {name}, у нас {errno:#x} ошибка!” “Привет Олег, у нас 0xbadc0ffee ошибка!” <p>Python’s new Formatted String Literals are similar to the JavaScript Template Literals added in ES2015. I think they’re quite a nice addi- tion to the language, and I’ve already started using them in my day- to-day Python 3 work. You can learn more about Formatted String Literals in the official Python documentation.15</p> <h4 id="4--шаблон-строк">4 – Шаблон строк</h4> <p>Еще один метод форматирования строк в python - шаблон строк. Этот метод проще и имеет менее мощный механизм, но в некоторых случаях это может быть именно то, что вы искали.</p> <p>Давайте рассмотрим простой пример приветствия:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from string import Template 
&gt;&gt;&gt; t = Template('Привет, $name!') 
&gt;&gt;&gt; t.substitute(name=name) 
'Привет, Олег!'
</code></pre></div></div> <p>Вы видите здесь, что нам нужно импортировать класс шаблона из встроенного модуля строки python. Строки шаблона не являются основной функцией языка, но они предоставляются модулем в стандартной библиотеке.</p> <p>Другое отличие состоит в том, что шаблоны строк не допускают спецификаторы формата. Таким образом, чтобы заставить наш пример строки с номером ошибки работать, нам нужно преобразовать номер ошибки int в шестнадцатеричную строку:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; templ_string = 'Привет $name, у нас $error ошибка!' 
&gt;&gt;&gt; Template(templ_string).substitute(
... name=name, error=hex(errno))
'Привет Олег, у нас 0xbadc0ffee ошибка!'
</code></pre></div></div> <p>Это отлично сработало, но вам, вероятно, интересно, когда можно использовать шаблоны строк в своих программах Python. Представляется, что лучший вариант использования шаблона строк - это обработка строк формата, созданных пользователями программы. Из-за их меньшей сложности строки шаблонов являются более безопасным выбором.</p> <p>Более сложное форматирование на мини-языках других методов форматирования строк может привести к уязвимостям в программах. Например, форматируемые строки могут обращаться к произвольным переменным в программе.</p> <p>Это означает, что если злонамеренный пользователь может предоставить строку формата они также могут потенциально организовать утечки секретных ключей и другой полезную информации.</p> <h4 id="какой-же-метод-форматрирования-строк-надо-использовать">Какой-же метод форматрирования строк надо использовать?</h4> <p>Имея так много способов для форматирования строк в python, сделать правильный выбор может показаться очень непросто.</p> <p>Лучше всего для правильного применения того или иного способа форматирования строк попробовать руководствоваться простым правилом:</p> <p>Если строки формата предоставляются Пользователем, используйте строки шаблона, чтобы избежать проблем безопасности. В противном случае используйте интерполяцию строк литералов, если вы используете Python 3.6+, тогда форматируйте строки “новым стилем”.</p> <p>Основные выводы</p> <p>• Существует несколько способов форматирования строк в python.</p> <p>• Каждый метод имеет свои индивидуальные плюсы и минусы. Ваш вариант использования будет влиять на то, какой метод вы должны использовать.</p> <p>• Если вы не можете решить, какой метод форматирования строк использовать, попробуйте приведенное выше правило форматирования строк.</p> <p><a href="https://dbader.org/img/pytricks-book/Python%20Tricks%20Sample.pdf">Источник: “Python Tricks The Book” Dan Bader</a></p> </div> <div class="likely likely-post"> <div class="telegram" data-url="https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html" data-title="Форматирование строк в python">Отправить</div> <div class="vkontakte" data-url="https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html" data-title="Форматирование строк в python">Поделиться</div> <div class="odnoklassniki" data-url="https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html" data-title="Форматирование строк в python">Класснуть</div> <div class="facebook" data-url="https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html" data-title="Форматирование строк в python">Поделиться</div> <div class="twitter" data-url="https://losthuman.ru/categories/library/2018/09/22/formatirovanie-strok-v-python.html" data-title="Форматирование строк в python">Твитнуть</div> </div> <!-- <div class="article-ad"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5706627784425194" data-ad-slot="8358109938"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div> --> <!----><div id="vk_comments"></div> <script type="text/javascript"> window.onload = function () { VK.init({apiId: 7004890, onlyWidgets: true}); VK.Widgets.Comments('vk_comments', {limit: 20, attach: "graffiti,photo,video,audio", norealtime: 0}); } </script><a class="u-url" href="/categories/library/2018/09/22/formatirovanie-strok-v-python.html" hidden></a> </article> </div> <div class="col-md-4"> <div class="article-ad"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- losthuman-aside --> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5706627784425194" data-ad-slot="4814492309" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div><ul> <li class="tags" ><a href="/tags/iphone">iphone (1) </a> </li> <li class="tags" ><a href="/tags/apple">apple (4) </a> </li> <li class="tags" ><a href="/tags/security">security (5) </a> </li> <li class="tags" ><a href="/tags/hackers">hackers (1) </a> </li> <li class="tags" ><a href="/tags/google">google (2) </a> </li> <li class="tags" ><a href="/tags/angular">angular (1) </a> </li> <li class="tags" ><a href="/tags/programming">programming (11) </a> </li> <li class="tags" ><a href="/tags/gagets">gagets (3) </a> </li> <li class="tags" ><a href="/tags/regex">regex (1) </a> </li> <li class="tags" ><a href="/tags/wordpress">wordpress (1) </a> </li> <li class="tags" ><a href="/tags/python">python (4) </a> </li> <li class="tags" ><a href="/tags/twitter">twitter (1) </a> </li> <li class="tags" ><a href="/tags/shazam">shazam (1) </a> </li> <li class="tags" ><a href="/tags/application">application (1) </a> </li> <li class="tags" ><a href="/tags/photo">photo (1) </a> </li> <li class="tags" ><a href="/tags/css">css (1) </a> </li> <li class="tags" ><a href="/tags/bittorrent">bittorrent (1) </a> </li> <li class="tags" ><a href="/tags/amazon">amazon (1) </a> </li> <li class="tags" ><a href="/tags/swift">swift (5) </a> </li> <li class="tags" ><a href="/tags/IOS">IOS (1) </a> </li> <li class="tags" ><a href="/tags/uber">uber (1) </a> </li> <li class="tags" ><a href="/tags/npm">npm (1) </a> </li> <li class="tags" ><a href="/tags/nodejs">nodejs (1) </a> </li> <li class="tags" ><a href="/tags/code">code (2) </a> </li> <li class="tags" ><a href="/tags/jekyll">jekyll (2) </a> </li> <li class="tags" ><a href="/tags/github">github (1) </a> </li> <li class="tags" ><a href="/tags/gitgubgages">gitgubgages (1) </a> </li> </ul><div class="btcwdgt-chart"> style="margin-top: 30px"> <script> (function(b,i,t,C,O,I,N) { window.addEventListener('load',function() { if(b.getElementById(C))return; I=b.createElement(i),N=b.getElementsByTagName(i)[0]; I.src=t;I.id=C;N.parentNode.insertBefore(I, N); },false) })(document,'script','https://widgets.bitcoin.com/widget.js','btcwdgt'); </script> </div> </div> </div> </div> <div class="article-ad"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5706627784425194" data-ad-slot="8358109938"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div> </div> </main><footer class="site-footer h-card"> <data class="u-url" href="/"></data> <div class="wrapper"> <h2 class="footer-heading">Losthuman</h2> <div class="footer-col-wrapper"> <div class="footer-col footer-col-1"> <ul class="contact-list"> <li class="p-name">Losthuman</li><li><a class="u-email" href="mailto:info@losthuman.ru">info@losthuman.ru</a></li></ul> </div> <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://twitter.com/losthuman9"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">losthuman9</span></a></li></ul> </div> <div class="footer-col footer-col-3"> <p>Ничего особо ценного</p> </div> </div> </div> </footer> <script src="/assets/likely.js"></script> </body> </html>
